version: "3"

services: 
    gitlab:
        image: 'gitlab/gitlab-ee:latest'
        restart: always
        hostname: 'gitlab'
        container_name: gitlab
        environment:
          GITLAB_OMNIBUS_CONFIG: |
            external_url 'https://192.168.221.1'
            gitlab_rails['gitlab_shell_ssh_port'] = 422
            # Add any other gitlab.rb configuration here, each on its own line
        ports:
          - '8083:80'
          - '8443:443'
          - '422:22'
        volumes:
          - 'gitlab_config:/etc/gitlab'
          - 'gitlab_logs:/var/log/gitlab'
          - 'gitlab_data:/var/opt/gitlab'

    jenkins:
      image: jenkins/jenkins:lts
      privileged: true
      user: root
      ports:
        - '8081:8080'
        - '50000:50000'
      container_name: jenkins
      volumes:
        - jenkins_data:/var/jenkins_home
        - /var/run/docker.sock:/var/run/docker.sock
        - /usr/local/bin/docker:/usr/local/bin/docker

    zabbix:
      image: zabbix/zabbix-appliance:latest
      container_name: zabbix
      ports: 
        - 8082:80
        - 10051:10051
      volumes: 
        - zabbix_data:/var/lib/mysql

    registry:
      image: registry:2
      restart: always
      container_name: registry
      ports: 
        - '5000:5000'
      volumes: 
        - docker_repo:/var/lib/registry
      





volumes: 
    gitlab_config:
    gitlab_logs:
    gitlab_data:
    jenkins_data:
    zabbix_data:
    docker_repo:

